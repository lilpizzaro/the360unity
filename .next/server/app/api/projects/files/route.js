(()=>{var e={};e.id=652,e.ids=[652],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{"use strict";e.exports=require("node:buffer")},8704:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{HTTPAccessErrorStatus:function(){return r},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return o},getAccessFallbackErrorTypeByStatus:function(){return u},getAccessFallbackHTTPStatus:function(){return n},isHTTPAccessFallbackError:function(){return i}});let r={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},s=new Set(Object.values(r)),o="NEXT_HTTP_ERROR_FALLBACK";function i(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r]=e.digest.split(";");return t===o&&s.has(Number(r))}function n(e){return Number(e.digest.split(";")[1])}function u(e){switch(e){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},16141:e=>{"use strict";e.exports=require("node:zlib")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31162:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isNextRouterError",{enumerable:!0,get:function(){return i}});let s=r(8704),o=r(49026);function i(e){return(0,o.isRedirectError)(e)||(0,s.isHTTPAccessFallbackError)(e)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},34631:e=>{"use strict";e.exports=require("tls")},37067:e=>{"use strict";e.exports=require("node:http")},37830:e=>{"use strict";e.exports=require("node:stream/web")},39727:()=>{},44708:e=>{"use strict";e.exports=require("node:https")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},49026:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{REDIRECT_ERROR_CODE:function(){return o},RedirectType:function(){return i},isRedirectError:function(){return n}});let s=r(52836),o="NEXT_REDIRECT";var i=function(e){return e.push="push",e.replace="replace",e}({});function n(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let t=e.digest.split(";"),[r,i]=t,n=t.slice(2,-2).join(";"),u=Number(t.at(-2));return r===o&&("replace"===i||"push"===i)&&"string"==typeof n&&!isNaN(u)&&u in s.RedirectStatusCode}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},51846:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{BailoutToCSRError:function(){return s},isBailoutToCSRError:function(){return o}});let r="BAILOUT_TO_CLIENT_SIDE_RENDERING";class s extends Error{constructor(e){super("Bail out to client-side rendering: "+e),this.reason=e,this.digest=r}}function o(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===r}},51906:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=51906,e.exports=t},52637:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isPostpone",{enumerable:!0,get:function(){return s}});let r=Symbol.for("react.postpone");function s(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}},52836:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return r}});var r=function(e){return e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e}({});("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56621:(e,t,r)=>{"use strict";r.d(t,{ND:()=>s});let s=(0,r(39398).createClient)("https://lvehgsniklchobuhjobl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx2ZWhnc25pa2xjaG9idWhqb2JsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyMzE3NjMsImV4cCI6MjA2NDgwNzc2M30.p8pNolmkEENmts-WsTaHWkI6lFlZnLJuBkTUIi8zVqg",{auth:{persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}}});process.env.NEXT_PUBLIC_SUPABASE_STORAGE_ACCESS_KEY,process.env.NEXT_PUBLIC_SUPABASE_STORAGE_SECRET_KEY},57075:e=>{"use strict";e.exports=require("node:stream")},57943:(e,t,r)=>{"use strict";r.d(t,{N:()=>i});var s=r(65591),o=r(88443);async function i(){let{userId:e}=(0,o.j)();return e?s.$v.users.getUser(e):null}},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65591:(e,t,r)=>{"use strict";r.d(t,{$v:()=>i});var s=r(10773),o=r(5020);let i=(0,s.c2)({apiKey:o.Lq,secretKey:o.rB,apiUrl:o.H$,apiVersion:o.mG,userAgent:"@clerk/nextjs@4.31.8",proxyUrl:o.Rg,domain:o.V2,isSatellite:o.fS})},73024:e=>{"use strict";e.exports=require("node:fs")},73136:e=>{"use strict";e.exports=require("node:url")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},76760:e=>{"use strict";e.exports=require("node:path")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return a}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var u=i?Object.getOwnPropertyDescriptor(e,n):null;u&&(u.get||u.set)?Object.defineProperty(s,n,u):s[n]=e[n]}return s.default=e,r&&r.set(e,s),s}(r(61120));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}let i={current:null},n="function"==typeof s.cache?s.cache:e=>e,u=console.warn;function a(e){return function(...t){u(e(...t))}}n(e=>{try{u(i.current)}finally{i.current=null}})},77030:e=>{"use strict";e.exports=require("node:net")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},88311:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>d,serverHooks:()=>x,workAsyncStorage:()=>j,workUnitAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{DELETE:()=>f,GET:()=>p,POST:()=>c});var o=r(96559),i=r(48088),n=r(37719),u=r(32190),a=r(57943),l=r(56621);async function c(e){let t=await (0,a.N)();if(!t)return u.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.id;try{let t=await e.formData(),s=t.get("projectId"),o=t.get("file"),i="true"===t.get("isCoverImage");if(!s||!o)return u.NextResponse.json({error:"Missing project ID or file"},{status:400});let{data:n}=await l.ND.from("projects").select("author_id").eq("id",s).single();if(!n||n.author_id!==r)return u.NextResponse.json({error:"Unauthorized to modify this project"},{status:403});o.name.split(".").pop();let a=`${r}/${s}/${Date.now()}-${o.name}`,c=await o.arrayBuffer(),{data:p,error:f}=await l.ND.storage.from("projects").upload(a,c,{contentType:o.type,cacheControl:"3600"});if(f)return console.error("Error uploading file:",f),u.NextResponse.json({error:"Failed to upload file"},{status:500});let{data:d}=l.ND.storage.from("projects").getPublicUrl(a);if(i)return await l.ND.from("projects").update({image:d.publicUrl}).eq("id",s),u.NextResponse.json({success:!0,fileUrl:d.publicUrl,isCoverImage:!0});{let{data:e}=await l.ND.from("projects").select("files").eq("id",s).single(),t=[...e?.files||[],d.publicUrl];return await l.ND.from("projects").update({files:t}).eq("id",s),u.NextResponse.json({success:!0,fileUrl:d.publicUrl,files:t})}}catch(e){return console.error("Error in project files POST route:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){let{searchParams:t}=new URL(e.url),r=t.get("projectId");if(!r)return u.NextResponse.json({error:"Missing project ID"},{status:400});try{let{data:e}=await l.ND.from("projects").select("author_id, files").eq("id",r).single();if(!e)return u.NextResponse.json({error:"Project not found"},{status:404});if(e.files&&e.files.length>0)return u.NextResponse.json({files:e.files});let{data:t,error:s}=await l.ND.storage.from("projects").list(`${e.author_id}/${r}`);if(s)return console.error("Error listing files:",s),u.NextResponse.json({error:"Failed to list files"},{status:500});let o=t.map(t=>{let{data:s}=l.ND.storage.from("projects").getPublicUrl(`${e.author_id}/${r}/${t.name}`);return s.publicUrl});return await l.ND.from("projects").update({files:o}).eq("id",r),u.NextResponse.json({files:o})}catch(e){return console.error("Error in project files GET route:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}async function f(e){let t=await (0,a.N)();if(!t)return u.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.id;try{let{searchParams:t}=new URL(e.url),s=t.get("projectId"),o=t.get("fileUrl");if(!s||!o)return u.NextResponse.json({error:"Missing project ID or file URL"},{status:400});let{data:i}=await l.ND.from("projects").select("author_id, files").eq("id",s).single();if(!i||i.author_id!==r)return u.NextResponse.json({error:"Unauthorized to modify this project"},{status:403});let n=new URL(o).pathname.split("/"),a=n.slice(n.indexOf("projects")+1).join("/"),{error:c}=await l.ND.storage.from("projects").remove([a]);if(c)return console.error("Error deleting file:",c),u.NextResponse.json({error:"Failed to delete file"},{status:500});let p=i.files.filter(e=>e!==o);return await l.ND.from("projects").update({files:p}).eq("id",s),u.NextResponse.json({success:!0,files:p})}catch(e){return console.error("Error in project files DELETE route:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/projects/files/route",pathname:"/api/projects/files",filename:"route",bundlePath:"app/api/projects/files/route"},resolvedPagePath:"D:\\the360unity-master\\the360unity-master\\src\\app\\api\\projects\\files\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:j,workUnitAsyncStorage:y,serverHooks:x}=d;function g(){return(0,n.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:y})}},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{},96559:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,190,443,398],()=>r(88311));module.exports=s})();